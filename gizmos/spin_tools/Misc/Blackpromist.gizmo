#! /spin/software/nuke/6.3v8/linux/64/Nuke6.3 -nx
version 6.3 v8
Gizmo {
 help "Emulates the Black Pro Mist (BPM) filter effect"
 tile_color 0xd68953ff
 gl_color 0xdd7e39ff
 note_font Verdana
 mapsize {0.15 0.15}
 addUserKnob {20 Controls}
 addUserKnob {7 diffusionamount l "Diffusion Amount" t "Size of the diffusion"}
 diffusionamount 1.15
 addUserKnob {7 diffusionlevel l "Diffusion Level" t "Opacity of the diffusion"}
 diffusionlevel 0.705
 addUserKnob {7 diffusionsoftness l "Diffusion Softness" t "Falloff of the diffusion" R 0 2}
 diffusionsoftness 1
 addUserKnob {7 highlightselection l "Highlight Selection" t "Selects the highlights that receive the diffusion" R 0 2}
 highlightselection 1
 addUserKnob {6 viewhighlight l "View Highlight Selection" t "View the highlights selected by Highlight Selection. Red is selected, blue is untouched." +STARTLINE}
 addUserKnob {6 affectalpha l "Affect Alpha" t "Whether the diffusion will affect the alpha or not" +STARTLINE}
 affectalpha true
}
 Roto {
  inputs 0
  curves {AnimTree: "" {
 Version: 1.2
 Flag: 0
 RootNode: 1
 Node: {
  NodeName: "Root" {
   Flag: 512
   NodeType: 1
   Transform: 0 0 S 0 0 S 0 0 S 0 0 S 0 1 S 0 1 S 0 0 S 0 1024 S 0 540 
   NumOfAttributes: 11
   "vis" S 0 1 "opc" S 0 1 "mbo" S 0 1 "mb" S 0 1 "mbs" S 0 0.5 "fo" S 0 1 "fx" S 0 0 "fy" S 0 0 "ff" S 0 1 "ft" S 0 0 "pt" S 0 0 
  }
  NumOfChildren: 1
  Node: {
   NodeName: "Bezier1" {
    Flag: 576
    NodeType: 3
    CurveGroup: "" {
     Transform: 0 0 S 1 830683 0 S 1 830683 0 S 1 830683 0 S 1 830683 1 S 1 830683 1 S 1 830683 0 S 1 830683 1039.74 S 1 830683 587.85 
     Flag: 0
     NumOfCubicCurves: 2
     CubicCurve: "" {
      Type: 0 Flag: 8192 Dim: 2
      NumOfPoints: 48
      0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 1019.2 S 1 830683 553.4 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 2.19995 S 1 830683 -0.799988 0 0 S 1 830683 1009.6 S 1 830683 560.8 0 0 S 1 830683 -2.19995 S 1 830683 0.799988 0 0 S 1 830683 -2.20001 S 1 830683 -8.79999 0 0 S 1 830683 995.8 S 1 830683 580.4 0 0 S 1 830683 2.20001 S 1 830683 8.79999 0 0 S 1 830683 -0.399963 S 1 830683 -5.39996 0 0 S 1 830683 1004.2 S 1 830683 600.4 0 0 S 1 830683 0.399963 S 1 830683 5.39996 0 0 S 1 830683 -2.59998 S 1 830683 -7.20001 0 0 S 1 830683 1005.4 S 1 830683 620.8 0 0 S 1 830683 2.59998 S 1 830683 7.20001 0 0 S 1 830683 -4.59998 S 1 830683 0 0 0 S 1 830683 1024.6 S 1 830683 637.6 0 0 S 1 830683 4.59998 S 1 830683 0 0 0 S 1 830683 -4 S 1 830683 -0.399963 0 0 S 1 830683 1038 S 1 830683 634.2 0 0 S 1 830683 4 S 1 830683 0.399963 0 0 S 1 830683 -2.59998 S 1 830683 -1.19995 0 0 S 1 830683 1050.4 S 1 830683 645.4 0 0 S 1 830683 2.59998 S 1 830683 1.19995 0 0 S 1 830683 -0.400024 S 1 830683 2.80005 0 0 S 1 830683 1064.6 S 1 830683 630.4 0 0 S 1 830683 0.400024 S 1 830683 -2.80005 0 0 S 1 830683 -1.59998 S 1 830683 3 0 0 S 1 830683 1074.6 S 1 830683 619.2 0 0 S 1 830683 1.59998 S 1 830683 -3 0 0 S 1 830683 3.59998 S 1 830683 10 0 0 S 1 830683 1087 S 1 830683 590 0 0 S 1 830683 -3.59998 S 1 830683 -10 0 0 S 1 830683 -0.599976 S 1 830683 5 0 0 S 1 830683 1077.4 S 1 830683 564.6 0 0 S 1 830683 0.599976 S 1 830683 -5 0 0 S 1 830683 10 S 1 830683 -2.40002 0 0 S 1 830683 1069.6 S 1 830683 543 0 0 S 1 830683 -10 S 1 830683 2.40002 0 0 S 1 830683 4 S 1 830683 0 0 0 S 1 830683 1052 S 1 830683 550.8 0 0 S 1 830683 -4 S 1 830683 0 0 0 S 1 830683 3.80005 S 1 830683 3.79999 0 0 S 1 830683 1040.4 S 1 830683 538.8 0 0 S 1 830683 -3.80005 S 1 830683 -3.79999 0 0 S 1 830683 3 S 1 830683 -5.40002 0 0 S 1 830683 1023 S 1 830683 535.8 0 0 S 1 830683 -3 S 1 830683 5.40002 0 
     }
     CubicCurve: "" {
      Type: 0 Flag: 8192 Dim: 2
      NumOfPoints: 48
      0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 2.19995 S 1 830683 -0.799988 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 -2.19995 S 1 830683 0.799988 0 0 S 1 830683 -2.20001 S 1 830683 -8.79999 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 2.20001 S 1 830683 8.79999 0 0 S 1 830683 -0.399963 S 1 830683 -5.39996 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 0.399963 S 1 830683 5.39996 0 0 S 1 830683 -2.59998 S 1 830683 -7.20001 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 2.59998 S 1 830683 7.20001 0 0 S 1 830683 -4.59998 S 1 830683 0 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 4.59998 S 1 830683 0 0 0 S 1 830683 -4 S 1 830683 -0.399963 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 4 S 1 830683 0.399963 0 0 S 1 830683 -2.59998 S 1 830683 -1.19995 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 2.59998 S 1 830683 1.19995 0 0 S 1 830683 -0.400024 S 1 830683 2.80005 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 0.400024 S 1 830683 -2.80005 0 0 S 1 830683 -1.59998 S 1 830683 3 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 1.59998 S 1 830683 -3 0 0 S 1 830683 3.59998 S 1 830683 10 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 -3.59998 S 1 830683 -10 0 0 S 1 830683 -0.599976 S 1 830683 5 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 0.599976 S 1 830683 -5 0 0 S 1 830683 10 S 1 830683 -2.40002 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 -10 S 1 830683 2.40002 0 0 S 1 830683 4 S 1 830683 0 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 -4 S 1 830683 0 0 0 S 1 830683 3.80005 S 1 830683 3.79999 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 -3.80005 S 1 830683 -3.79999 0 0 S 1 830683 3 S 1 830683 -5.40002 0 0 S 1 830683 0 S 1 830683 0 0 0 S 1 830683 -3 S 1 830683 5.40002 0 
     }
     NumOfAttributes: 44
     "vis" S 0 1 "r" S 0 1 "g" S 0 1 "b" S 0 1 "a" S 0 1 "ro" S 0 0 "go" S 0 0 "bo" S 0 0 "ao" S 0 0 "opc" S 0 1 "bm" S 0 0 "inv" S 0 0 "mbo" S 0 0 "mb" S 0 1 "mbs" S 0 0.5 "mbsot" S 0 0 "mbso" S 0 0 "fo" S 0 1 "fx" S 0 0 "fy" S 0 0 "ff" S 0 1 "ft" S 0 0 "src" S 0 0 "stx" S 0 0 "sty" S 0 0 "str" S 0 0 "sr" S 0 0 "ssx" S 0 1 "ssy" S 0 1 "ss" S 0 0 "spx" S 0 1024 "spy" S 0 540 "stot" S 0 0 "sto" S 0 0 "sv" S 0 0 "sf" S 0 1 "sb" S 0 1 "nv" S 0 1 "view1" S 0 1 "ltn" S 0 830683 "ltm" S 0 830683 "ltt" S 0 0 "tt" S 0 4 "pt" S 0 0 
    }
   }
   NumOfChildren: 0
  }
 }
}
}
  toolbox {selectAll {
  { selectAll ssx 1 ssy 1 sf 1 }
  { createBezier ssx 1 ssy 1 sf 1 sb 1 tt 4 }
  { createBSpline ssx 1 ssy 1 sf 1 sb 1 }
  { createEllipse ssx 1 ssy 1 sf 1 sb 1 }
  { createRectangle ssx 1 ssy 1 sf 1 sb 1 }
  { brush ssx 1 ssy 1 sf 1 sb 1 }
  { eraser src 2 ssx 1 ssy 1 sf 1 sb 1 }
  { clone src 1 ssx 1 ssy 1 sf 1 sb 1 }
  { reveal src 3 ssx 1 ssy 1 sf 1 sb 1 }
  { dodge src 1 ssx 1 ssy 1 sf 1 sb 1 }
  { burn src 1 ssx 1 ssy 1 sf 1 sb 1 }
  { blur src 1 ssx 1 ssy 1 sf 1 sb 1 }
  { sharpen src 1 ssx 1 ssy 1 sf 1 sb 1 }
  { smear src 1 ssx 1 ssy 1 sf 1 sb 1 }
} }
  toolbar_brush_hardness 0.200000003
  toolbar_lifetime_type all
  toolbar_source_transform_scale {1 1}
  toolbar_source_transform_center {320 240}
  colorOverlay 0
  lifetime_type "all frames"
  lifetime_start 830683
  lifetime_end 830683
  motionblur_shutter_offset_type centred
  source_black_outside true
  createNewTrack {{-1} "-1\t(none)\t-1" "1000\tNew Track Layer\t1000"}
  name Roto1
  xpos 416
  ypos 37
 }
 Crop {
  box {992.5999756 530.2000122 1092.599976 648.2000122}
  name Crop1
  xpos 416
  ypos 61
 }
set N144b1cb0 [stack 0]
 Viewer {
  viewerProcess None
  input_process false
  name Viewer1
  xpos 29
  ypos 153
 }
 Input {
  inputs 0
  name source
  xpos 453
  ypos -79
 }
set N144c36f0 [stack 0]
 Dot {
  name Dot2
  xpos 602
  ypos -76
 }
 Dot {
  name Dot3
  xpos 602
  ypos 254
 }
 Constant {
  inputs 0
  color {1 0 0 1}
  name Constant1
  xpos 177
  ypos -151
 }
push $N144c36f0
 Keyer {
  operation "luminance key"
  range {{.44*(parent.highlightselection) i} {.5*(parent.highlightselection) i} 1 1}
  name Keyer1
  xpos 287
  ypos -84
 }
set N144d9d40 [stack 0]
 Merge2 {
  inputs 2
  operation in
  name In1
  xpos 177
  ypos -79
 }
 Constant {
  inputs 0
  color {0 0 1 1}
  name Constant2
  xpos 29
  ypos -155
 }
push $N144d9d40
 Invert {
  name Invert1
  xpos 177
  ypos -17
 }
 Merge2 {
  inputs 2
  operation in
  name In2
  xpos 29
  ypos -53
 }
 Merge2 {
  inputs 2
  name Merge1
  xpos 29
  ypos 4
 }
push $N144b1cb0
 Transform {
  scale {{.1*(parent.diffusionamount*2) i}}
  center {1041 596}
  name Transform1
  xpos 416
  ypos 87
 }
 Blur {
  size {{parent.diffusionsoftness*50 i}}
  name Blur1
  xpos 416
  ypos 111
 }
push $N144c36f0
 Dot {
  name Dot1
  xpos 420
  ypos -10
 }
push $N144d9d40
 Merge2 {
  inputs 2
  operation in
  name In
  xpos 287
  ypos -10
 }
 Convolve {
  inputs 2
  name Convolve1
  xpos 287
  ypos 102
  disable {{parent.viewhighlight i}}
 }
push $N144c36f0
 Merge2 {
  inputs 2
  operation plus
  mix {{.1*(parent.diffusionlevel*2) i}}
  name Scrn
  xpos 177
  ypos 116
  disable {{parent.viewhighlight i}}
 }
 Merge2 {
  inputs 2
  name Merge2
  xpos 177
  ypos 171
  disable {{parent.viewhighlight>0?0:1 i}}
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy1
  xpos 177
  ypos 246
  disable {{parent.affectalpha i}}
 }
 Output {
  name Output1
  xpos 177
  ypos 333
 }
end_group
